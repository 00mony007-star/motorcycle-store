import{r as x,j as e,aq as U,g as G,aA as H,x as O,b6 as I,aE as z,aF as J,b7 as K,aG as l,b8 as j}from"./vendor-DcRwrwk9.js";import{c as M,u as Q,C as W,d as X,e as Y,h as Z,I as m,B as T,g as _}from"./index-BEUX0Z6D.js";import{L as a}from"./Label-CEq3WBdJ.js";import{C as $}from"./Checkbox-BoQFHUv_.js";import{S as ee,a as te,b as se,c as re,d as ie}from"./Select-kEkG80sN.js";const f=x.forwardRef(({className:n,...u},d)=>e.jsx("textarea",{className:M("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-primary focus-visible:shadow-glow-primary disabled:cursor-not-allowed disabled:opacity-50",n),ref:d,...u}));f.displayName="Textarea";const h=_(),ae=J({title:l().min(3,"Title is required"),brand:l().optional(),categoryId:l().min(1,"Category is required"),price:j.number().min(0,"Price must be positive"),compareAtPrice:j.number().optional(),stock:j.number().int("Stock must be an integer"),description:l().min(10,"Description is required"),shortDescription:l().min(5,"Short description is required"),images:l().min(1,"At least one image URL is required"),featured:K().default(!1)});function me(){var C,P,S,N,w,k,F,A,D;const{id:n}=U(),u=G(),{toast:d}=Q(),[s,E]=x.useState(null),[v,L]=x.useState([]),[q,B]=x.useState(!!n),p=!n,{control:b,register:o,handleSubmit:R,reset:y,formState:{errors:c}}=H({resolver:z(ae)});x.useEffect(()=>{async function r(){try{const i=await h.categories.list();if(L(i),!p){const t=await h.products.getById(n);E(t),t&&y({title:t.title,brand:t.brand,categoryId:t.category.id,price:t.price,compareAtPrice:t.compareAtPrice,stock:t.stock,description:t.description,shortDescription:t.shortDescription,images:t.images.join(", "),featured:t.featured})}}catch{d({variant:"destructive",title:"Failed to load data"})}finally{B(!1)}}r()},[n,p,y,d]);const V=async r=>{try{const i=v.find(g=>g.id===r.categoryId);if(!i)throw new Error("Category not found");const t={...r,category:i,images:r.images.split(",").map(g=>g.trim()),rating:(s==null?void 0:s.rating)||0,reviewCount:(s==null?void 0:s.reviewCount)||0,tags:(s==null?void 0:s.tags)||[],features:(s==null?void 0:s.features)||[]};p?(await h.products.create(t),d({title:"Product created successfully"})):(await h.products.update(n,t),d({title:"Product updated successfully"})),u("/admin/products")}catch{d({variant:"destructive",title:"Operation failed"})}};return q?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(O,{className:"h-8 w-8 animate-spin"})}):e.jsxs(W,{children:[e.jsx(X,{children:e.jsx(Y,{children:p?"Create Product":"Edit Product"})}),e.jsx(Z,{children:e.jsxs("form",{onSubmit:R(V),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"title",children:"Title"}),e.jsx(m,{id:"title",...o("title")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(C=c.title)==null?void 0:C.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"brand",children:"Brand"}),e.jsx(m,{id:"brand",...o("brand")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(P=c.brand)==null?void 0:P.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"categoryId",children:"Category"}),e.jsx(I,{name:"categoryId",control:b,render:({field:r})=>e.jsxs(ee,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(te,{children:e.jsx(se,{placeholder:"Select a category"})}),e.jsx(re,{children:v.map(i=>e.jsx(ie,{value:i.id,children:i.name},i.id))})]})}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(S=c.categoryId)==null?void 0:S.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"price",children:"Price"}),e.jsx(m,{id:"price",type:"number",step:"0.01",...o("price")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(N=c.price)==null?void 0:N.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"compareAtPrice",children:"Compare At Price"}),e.jsx(m,{id:"compareAtPrice",type:"number",step:"0.01",...o("compareAtPrice")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(w=c.compareAtPrice)==null?void 0:w.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"stock",children:"Stock"}),e.jsx(m,{id:"stock",type:"number",...o("stock")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(k=c.stock)==null?void 0:k.message})]})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"shortDescription",children:"Short Description"}),e.jsx(f,{id:"shortDescription",...o("shortDescription")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(F=c.shortDescription)==null?void 0:F.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"description",children:"Full Description"}),e.jsx(f,{id:"description",rows:5,...o("description")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(A=c.description)==null?void 0:A.message})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"images",children:"Image URLs (comma-separated)"}),e.jsx(m,{id:"images",...o("images")}),e.jsx("p",{className:"text-destructive text-xs mt-1",children:(D=c.images)==null?void 0:D.message})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{name:"featured",control:b,render:({field:r})=>e.jsx($,{id:"featured",checked:r.value,onCheckedChange:r.onChange})}),e.jsx(a,{htmlFor:"featured",children:"Featured Product"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>u("/admin/products"),children:"Cancel"}),e.jsx(T,{type:"submit",children:"Save Product"})]})]})})]})}export{me as AdminProductEditPage};
