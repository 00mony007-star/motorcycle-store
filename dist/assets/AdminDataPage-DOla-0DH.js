import{r as j,j as t,bp as g,bq as w}from"./vendor-DcRwrwk9.js";import{u as b,C as N,d as S,e as v,k as y,h as C,B as m,m as x,n as D}from"./index-BEUX0Z6D.js";function A(){const{toast:n}=b(),u=j.useRef(null),h=async()=>{try{const e=await x(),c=await e.getAll("products"),i=await e.getAll("categories"),l=await e.getAll("users"),d=await e.getAll("coupons"),r=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify({products:c,categories:i,users:l,coupons:d},null,2))}`,s=document.createElement("a");s.href=r,s.download=`motogear-backup-${new Date().toISOString().split("T")[0]}.json`,s.click(),n({title:"Export Successful",description:"Data has been exported to a JSON file."})}catch{n({variant:"destructive",title:"Export Failed",description:"Could not export data."})}},f=async e=>{var l;const c=(l=e.target.files)==null?void 0:l[0];if(!c)return;const i=new FileReader;i.onload=async d=>{var p;try{const r=(p=d.target)==null?void 0:p.result;if(typeof r!="string")throw new Error("Invalid file content");const s=JSON.parse(r);if(!s.products||!s.categories)throw new Error("Invalid JSON structure.");await D();const o=(await x()).transaction(["products","categories","users","coupons"],"readwrite");await Promise.all([...s.products.map(a=>o.objectStore("products").put(a)),...s.categories.map(a=>o.objectStore("categories").put(a)),...(s.users||[]).map(a=>o.objectStore("users").put(a)),...(s.coupons||[]).map(a=>o.objectStore("coupons").put(a))]),await o.done,n({title:"Import Successful",description:"Data has been imported. Please refresh the page."})}catch(r){n({variant:"destructive",title:"Import Failed",description:r.message||"Could not import data."})}},i.readAsText(c)};return t.jsx("div",{className:"container mx-auto px-4 py-12",children:t.jsxs(N,{children:[t.jsxs(S,{children:[t.jsx(v,{children:"Data Management"}),t.jsx(y,{children:"Import or export your store's data. This is a destructive action."})]}),t.jsxs(C,{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Export Data"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Download all products, categories, and users as a JSON file."})]}),t.jsxs(m,{onClick:h,children:[t.jsx(g,{className:"mr-2 h-4 w-4"})," Export"]})]}),t.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"Import Data"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a JSON file to replace all current data. This cannot be undone."})]}),t.jsxs(m,{onClick:()=>{var e;return(e=u.current)==null?void 0:e.click()},variant:"outline",children:[t.jsx(w,{className:"mr-2 h-4 w-4"})," Import"]}),t.jsx("input",{type:"file",ref:u,onChange:f,accept:".json",className:"hidden"})]})]})]})})}export{A as AdminDataPage};
